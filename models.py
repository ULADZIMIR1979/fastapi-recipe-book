"""
–ú–æ–¥—É–ª—å —Å –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –∏ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–∏–º–∏
"""

from sqlalchemy import Column, Integer, String, Text, Table, ForeignKey
from sqlalchemy.orm import relationship
from database import Base

print("üìä –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö...")

# –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–≤—è–∑–∏ –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ –∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏
# –ö–∞–∂–¥—ã–π —Ä–µ—Ü–µ–ø—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ –º–Ω–æ–≥–∏—Ö —Ä–µ—Ü–µ–ø—Ç–∞—Ö
recipe_ingredient = Table(
    'recipe_ingredient',  # –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    Base.metadata,        # –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞
    Column('recipe_id', Integer, ForeignKey('recipes.id')),      # –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ —Ä–µ—Ü–µ–ø—Ç–∞–º
    Column('ingredient_id', Integer, ForeignKey('ingredients.id')) # –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º
)

print("‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ recipe_ingredient")


class Recipe(Base):
    """
    –ú–æ–¥–µ–ª—å —Ä–µ—Ü–µ–ø—Ç–∞ - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏

    –ê—Ç—Ä–∏–±—É—Ç—ã:
        id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–∞
        title: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞
        cooking_time: –≤—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö
        description: —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞
        views: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ (–¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏)
        ingredients: —Å–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ —ç—Ç–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
    """
    __tablename__ = "recipes"  # –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

    print("üç≥ –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å Recipe...")

    id = Column(Integer, primary_key=True, index=True)  # –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á —Å –∏–Ω–¥–µ–∫—Å–æ–º
    title = Column(String(100), nullable=False, index=True)  # –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å –∏–Ω–¥–µ–∫—Å–æ–º
    cooking_time = Column(Integer, nullable=False)  # –≤—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    description = Column(Text, nullable=False)  # –æ–ø–∏—Å–∞–Ω–∏–µ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    views = Column(Integer, default=0, nullable=False)  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0

    # –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏
    # secondary - —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    # back_populates - —Å–æ–∑–¥–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –≤ –º–æ–¥–µ–ª–∏ Ingredient
    ingredients = relationship(
        "Ingredient",
        secondary=recipe_ingredient,
        back_populates="recipes"
    )

    print("‚úÖ –ú–æ–¥–µ–ª—å Recipe —Å–æ–∑–¥–∞–Ω–∞!")

    def __repr__(self):
        return f"<Recipe(id={self.id}, title='{self.title}', views={self.views})>"


class Ingredient(Base):
    """
    –ú–æ–¥–µ–ª—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ - —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏

    –ê—Ç—Ä–∏–±—É—Ç—ã:
        id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
        name: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
        recipes: —Å–ø–∏—Å–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ç–æ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç
    """
    __tablename__ = "ingredients"

    print("ü•ï –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å Ingredient...")

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(50), nullable=False, unique=True, index=True)  # —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ

    # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏
    recipes = relationship(
        "Recipe",
        secondary=recipe_ingredient,
        back_populates="ingredients"
    )

    print("‚úÖ –ú–æ–¥–µ–ª—å Ingredient —Å–æ–∑–¥–∞–Ω–∞!")

    def __repr__(self):
        return f"<Ingredient(id={self.id}, name='{self.name}')>"


print("‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã!")